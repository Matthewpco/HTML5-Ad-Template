<script>
  function TRDadvertisement(options) {
    els = {
      mainDocument: window.top.document,
      mainWindow: window.parent.top.window,
      scrolled: false,
    };
    adProps = {
      backgroundImg: '',
      //"[%backgroundImg%]",
      backgroundImgScrld: '',
      //"[%backgroundImgScrld%]",
      buttonColor: '',
      //"[%buttonColor%]",
      buttonText: '',
      //"[%buttonText%]",
      ctaLink: '',
      //"[%ctaLink%]",
      headingColor:  '',
      //"[%headingColor%]",
      headingText:  '',
      //"[%headingText%]",
      impressionTrackers: [
        "[%ImpressionTracker1%]",
        "[%ImpressionTracker2%]",
        "[%ImpressionTracker3%]",
      ],
      logo: '',
      //"[%logo%]",   
    };

    fn = {
      init() {
        let container = els.mainDocument.querySelector("#pushdown");
        let position = els.mainWindow.scrollY;
        console.log(`position is : ${position}`);
        let style = fn.constructStyleSheet();
        container.appendChild(style);
        //fn.insertHtmlElement();

        // TODO needs further testing several bugs currently exist NOTE Scroll functionality appears to be setup on new preview site.
        if (position == 0) {
          fn.insertHtmlElement(adProps.backgroundImg);
        } else {
          fn.insertHtmlScrolledElement(adProps.backgroundImgScrld);
        }
        els.mainWindow.addEventListener("scroll", fn.scrollChange);
        let trdHeader = els.mainDocument.querySelector("#trd-header");


        fn.attachTrackers();
      },

      createHtmlElement(image) {
        let adWrapper = document.createElement("div");
        let adImg = document.createElement("img");
        let adImgClick = document.createElement("a");
        adWrapper.classList.add("static-intermission");
        adImg.classList.add("intermission-image");
        let advertisement = `    
        <div class="full-section"> 
          <img  class="one-fifth-section" src=${adProps.logo || "https://via.placeholder.com/350x350?text=350x350+TestLogo"} alt="background"/>
          <div class="three-fifth-section">
            <h2 class="pushdown-hdg" style="color: ${adProps.headingColor || "seagreen"}">${adProps.headingText || "Default Heading Text"}</h2>
            <a href="${adProps.ctaLink}" class="pushdown-link">
              <button class="pushdown-btn" style="background-color: ${adProps.buttonColor}">${adProps.buttonText || "Default Button Text"}</button>
            </a>
          </div>
          <img  class="one-fifth-section" src=${adProps.logo || "https://via.placeholder.com/350x350?text=350x350+TestLogo"} alt="background"/>
        </div>`;
        adWrapper.innerHTML = advertisement;
        return adWrapper;
      },

      insertHtmlElement(image) {
        let container = els.mainDocument.querySelector("#pushdown");
        let placeholder = container.firstElementChild;
        let advertisement = fn.createHtmlElement(image);
        container.replaceChild(advertisement, placeholder);
      },

      insertHtmlScrolledElement(creative) {
        let container = els.mainDocument.querySelector("#pushdown");
        let placeholder = container.firstElementChild;
        let advertisement = document.createElement("div");
        let adImg = document.createElement("img");
        let adImgClick = document.createElement("a");
        advertisement.classList.add("static-intermission");
        adImg.classList.add("intermission-image");

        let billboard = `    
        <div class="full-section-scr"> 
          <img  class="one-fifth-section" src=${adProps.logo || "https://via.placeholder.com/350x350?text=350x350+TestLogo"} alt="background"/>
          <div class="three-fifth-section">
            <h2 class="pushdown-hdg" style="color: ${adProps.headingColor || "seagreen"}">${adProps.headingText || "Default Heading Text"}</h2>
            <a href="${adProps.ctaLink}" class="pushdown-link">
              <button class="pushdown-btn" style="background-color: ${adProps.buttonColor}">${adProps.buttonText || "Default Button Text"}</button>
            </a>
          </div>
          <img  class="one-fifth-section" src=${adProps.logo || "https://via.placeholder.com/350x350?text=350x350+TestLogo"} alt="background"/>
        </div>`;
        advertisement.innerHTML = billboard;

        container.replaceChild(advertisement, placeholder);
        container.classList.add("scrollFixed");
      },

      attachTrackers() {
        let staticIntermission = els.mainDocument.querySelector(
          ".static-intermission"
        );
        for (let i = 0; i < adProps.impressionTrackers.length; i++) {
          let tracker = adProps.impressionTrackers[i];
          if (tracker) {
            let impression = document.createElement("img");
            tracker = tracker.split("\n").join("").split(" ").join("");
            impression.src = "%%VIEW_URL_UNESC%%" + tracker;
            impression.classList.add("impression");
            staticIntermission.appendChild(impression);
          }
        }
      },

      scrollChange() {
        let distance = window.scrollY;
        console.log(distance);

        if (distance > 200 && els.scrolled) {
          fn.insertHtmlScrolledElement(adProps.backgroundImgScrld);
          let container = els.mainDocument.querySelector("#pushdown");
          //let button = els.mainDocument.querySelector(".ad-button");
          //let logo = els.mainDocument.querySelector(".ad-logo");
          //button.classList.add("collapsedButton");
          //logo.classList.add("collapsedLogo");
          container.classList.add("scrollFixed");
          els.scrolled = false;
        }
        if (distance == 0 && !els.scrolled) {
          fn.insertHtmlElement(adProps.backgroundImg);
          let container = els.mainDocument.querySelector("#pushdown");
          //let button = els.mainDocument.querySelector(".ad-button");
          //let logo = els.mainDocument.querySelector(".ad-logo");
          //logo.classList.remove("collapsedLogo");
          //button.classList.remove("collapsedButton");
          container.classList.remove("scrollFixed");
          els.scrolled = true;
        }
      },

      constructStyleSheet() {
        var styleSheet = document.createElement("style");
        styleSheet.innerHTML = ` 
        .one-fifth-section {
          display: flex!important;
          width: 20%!important;
        }
        .full-section {
          width:100%!important;
          display: flex!important;
          background-image: url(${adProps.backgroundImg || "https://via.placeholder.com/1900x400?text=1900x400+BaseImg"});
          max-height: 400px;
        }
        .full-section-scr {
          width:100%!important;
          display: flex!important;
          background-image: url(${adProps.backgroundImgScrld || "https://via.placeholder.com/1900x100?text=1900x100+ScrolledImg"});
          max-height: 100px;
        }
        .pushdown-btn {
          font-family: Arial,sans-serif;
          font-size: 1rem;
        }
        .pushdown-hdg {
          font-family: 'Open Sans',sans-serif;
          font-size: 1.5rem;
          height: 70%;
        }
        .pushdown-link {

        }
        .scrollFixed {
          position: fixed;
          top: 0;
          width: 100%;
          margin: 0;
          z-index: 100;
        }
        .three-fifth-section {
          display: flex!important;
          width: 60%;
          flex-direction: column;
          align-items: center;
        }
        @keyframes slideInFromLeft {
          0% {transform: translateX(-100%);opacity: 0;}
          100% {transform: translateX(0);opacity: 1;}}
        @keyframes slideInFromRight {
          0% {transform: translateX(100%);opacity: 0;}
          100% {transform: translateX(0);opacity: 1;}}
        @keyframes imageShowUp {
          0% {opacity: 0;}
          100% {opacity: 1;}
        }
        @media screen and (max-width:767px) {
        }`;
        return styleSheet;
      }
    };

    fn.init();
    
  }

  window.trd_out_stream = new TRDadvertisement();
</script>